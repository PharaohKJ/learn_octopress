---
layout: post
title: "http timeoutの処理"
date: 2015-09-25 02:54:32 +0900
comments: true
categories: 
---

ハハハ、twitterのAPIがつながらないとかタイムアウト連発とかなるわけないじゃないですかー、という慢心のおかげで大変なことになったという話。

さきほど書いたblogをpushしたら、自動的にjenkinsがAmazon cdnに配置してくれるはずが、なんだか全然置いてくれてる気がしない。

ハテ？と見に行ったら、どうやら、20分おきに回しているRTWatcherの処理が遅くて遅くてビルドキューがつまってしまっていたようだ。

timeoutのデフォルト値は1分ぐらいらしく、そうなると、このエラー1つにつき、1分、5ループするので5分、30記事だとすると150分で2.5時間・・・。これは大変まずい。

ということでこちらのページを参考にしてtimeoutをよりまともに実装した。

```ruby
  http.open_timeout = 3
  http.read_timeout = 3
```

まぁちょっと厳し目の数字だが、20分おきにリトライするわけだしこれで様子を見ようと思う。
